{"version":3,"sources":["../../../src/lib/plugins/correlator.plugin.js"],"names":["uuid","require","assertId","option","Object","assign","correlationId","v4","assertIdMiddleware","next","routingKey","message","options","modifiedOptions","publishResponse","module","exports","pluginAPI","log","getPluginLogger","info","send","publish"],"mappings":";;AAAA;;;AAGA,MAAMA,OAAOC,QAAQ,MAAR,CAAb;;AAEA;;;;;AAKA,SAASC,QAAT,CAAmBC,MAAnB,EAA2B;AACzB,SAAOC,OAAOC,MAAP,CACL,EADK,EAEL,EAAEC,eAAeN,KAAKO,EAAL,EAAjB,EAFK,EAGLJ,MAHK,CAAP;AAKD;;AAED;;;;;AAKA,SAASK,kBAAT,CAA6BC,IAA7B,EAAmC;AACjC,SAAO,CAACC,UAAD,EAAaC,OAAb,EAAsBC,OAAtB,KAAkC;AACvC,UAAMC,kBAAkBX,SAASU,OAAT,CAAxB;AACA,UAAME,kBAAkBL,KAAKC,UAAL,EAAiBC,OAAjB,EAA0BE,eAA1B,CAAxB;AACA,WAAOC,eAAP;AACD,GAJD;AAKD;;AAEDC,OAAOC,OAAP,GAAiB,UAAUC,SAAV,EAAqB;AACpC,QAAMC,MAAMD,UAAUE,eAAV,EAAZ;AACAD,MAAIE,IAAJ,CAAS,0BAAT;AACA,SAAO;AACLC,UAAOb,kBADF;AAELc,aAASd;AAFJ,GAAP;AAID,CAPD","file":"correlator.plugin.js","sourcesContent":["/**\n * Created by balmasi on 2017-06-05.\n */\nconst uuid = require('uuid');\n\n/**\n * Adds a correlationId on message if one isn't already defined\n * @param {object} option - a json you want to send across the wire\n * @return {object} - message with correlationId added as a property if not already defined\n */\nfunction assertId (option) {\n  return Object.assign(\n    {},\n    { correlationId: uuid.v4() },\n    option\n  );\n}\n\n/**\n * The middleware pipeline function following the plugin specification\n * @param {function} next - next function in the pipeline\n * @return {function}\n */\nfunction assertIdMiddleware (next) {\n  return (routingKey, message, options) => {\n    const modifiedOptions = assertId(options);\n    const publishResponse = next(routingKey, message, modifiedOptions);\n    return publishResponse;\n  }\n}\n\nmodule.exports = function (pluginAPI) {\n  const log = pluginAPI.getPluginLogger();\n  log.info('Using Correlator Plugin.');\n  return {\n    send:  assertIdMiddleware,\n    publish: assertIdMiddleware\n  };\n};"]}